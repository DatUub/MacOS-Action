import isEqual from "lodash/isEqual.js";
import omit from "lodash/omit.js";
/**
 * Transform bigint to string
 * @param obj - object
 * @returns
 */
function jsonToString(obj) {
    return JSON.stringify(obj, (key, value) => typeof value === "bigint" ? value.toString() : value);
}
/**
 * Recursively match field
 *
 * @param object
 * @param keys
 * @param onMatch
 */
export function RecursivelyMatchField(object, keys, onMatch) {
    Object.keys(object).some(function (k) {
        if (keys.includes(k)) {
            onMatch(object, k);
        }
        if (object[k] && typeof object[k] === "object") {
            RecursivelyMatchField(object[k], keys, onMatch);
        }
    });
}
/**
 * Check if ApplicationCommand and DApplicationCommand has same properties
 *
 * @param findCommand
 * @param DCommand
 * @param isGuild
 * @returns
 */
export function isApplicationCommandEqual(findCommand, DCommand, isGuild) {
    const commandJson = findCommand.toJSON();
    const rawData = DCommand.toJSON();
    // replace undefined fields with null
    RecursivelyMatchField(commandJson, ["descriptionLocalizations", "nameLocalizations"], (object, key) => {
        if (object[key] === undefined) {
            object[key] = null;
        }
    });
    // replace null fields with undefined
    RecursivelyMatchField(commandJson, ["descriptionLocalized", "nameLocalized", "dmPermission"], (object, key) => {
        if (object[key] === null) {
            object[key] = undefined;
        }
    });
    // remove unwanted fields
    if (isGuild) {
        RecursivelyMatchField(rawData, ["dmPermission"], (object, key) => {
            object[key] = undefined;
        });
    }
    const firstJson = JSON.parse(jsonToString(omit(commandJson, "id", "applicationId", "guild", "guildId", "version", "descriptionLocalized", "nameLocalized", "permissions", "defaultPermission")));
    const secondJson = JSON.parse(jsonToString(rawData));
    const response = isEqual(firstJson, secondJson);
    return response;
}
//# sourceMappingURL=comparison.js.map